<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auction Formatter</title>
    <script>
        // Parse the auctions JSON data passed from the view
        const auctions = JSON.parse('{{ auctions|safe }}');

        function updateAuctionDropdown() {
            const warehouseSelect = document.getElementById('selected_warehouse');
            const auctionSelect = document.getElementById('auction_id');
            const selectedWarehouse = warehouseSelect.value;

            // Clear existing options
            auctionSelect.innerHTML = '<option value="">Select an auction</option>';

            // Filter auctions for the selected warehouse
            const filteredAuctions = auctions.filter(auction => auction.warehouse === selectedWarehouse);

            // Add new options
            filteredAuctions.forEach(auction => {
                const option = document.createElement('option');
                option.value = auction.id;
                option.textContent = `${auction.title} (${auction.id})`;
                auctionSelect.appendChild(option);
            });
        }

        // Call updateAuctionDropdown when the page loads to set initial state
        document.addEventListener('DOMContentLoaded', updateAuctionDropdown);
    </script>
</head>
<body>
    <h1>Auction Formatter</h1>
    <form method="post">
        {% csrf_token %}
        <div>
            <label for="selected_warehouse">Selected Warehouse:</label>
            <select id="selected_warehouse" name="selected_warehouse" onchange="updateAuctionDropdown()">
                <option value="">Select a warehouse</option>
                {% for warehouse in warehouses %}
                    <option value="{{ warehouse }}">{{ warehouse }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label for="auction_id">Auction ID:</label>
            <select id="auction_id" name="auction_id" required>
                <option value="">Select an auction</option>
                <!-- Options will be populated dynamically by JavaScript -->
            </select>
        </div>
        <button type="submit">Format Auction</button>
    </form>
</body>
</html>